<div class="tabs">
  <button class="tab-item" [class.active]="$selectedTab() === 'lab'" (click)="$selectedTab.set('lab')">Lab</button>
  <button class="tab-item" [class.active]="$selectedTab() === 'metrics'" (click)="$selectedTab.set('metrics')">Metrics</button>
  <button class="tab-item" [class.active]="$selectedTab() === 'advanced'" (click)="$selectedTab.set('advanced')">Advanced</button>
</div>

@if ($selectedTab() === 'lab') {
  <!-- GIỮ NGUYÊN LAB UI -->
  <div>
    <h3>AMQP Lab</h3>

    <label>Exchange</label>
    <input [ngModel]="$exchange()" (ngModelChange)="setExchange($event)" />

    <label>Queue</label>
    <input [ngModel]="$queue()" (ngModelChange)="setQueue($event)" />

    <label>Routing Key</label>
    <input [ngModel]="$routingKey()" (ngModelChange)="setRoutingKey($event)" />

    <label>Message</label>
    <textarea [ngModel]="$message()" (ngModelChange)="setMessage($event)"></textarea>

    <div class="buttons">
      <button (click)="declareExchange()">Declare Exchange</button>
      <button (click)="declareQueue()">Declare Queue</button>
      <button (click)="bind()">Bind</button>
      <button (click)="publish()">Publish</button>
      <button (click)="consume()">Consume</button>
    </div>

    @if ($consumeResult()) {
    @let msg = $consumeResult();
    <div>
      <pre>{{ msg | json }}</pre>
    </div>
    }

    <h3>Logs</h3>
    <pre>{{ $logs() | json }}</pre>
  </div>
}

@if ($selectedTab() === 'metrics') {
  <div>
    <h3>Prometheus Metrics</h3>

    @if ($metrics()) {
      @let m = $metrics();
      <div class="metric-block">
        <p>Connections: {{ m!.rabbitmqConnections }}</p>
        <p>Queues: {{ m!.rabbitmqQueues }}</p>
        <p>Ready: {{ m!.messagesReady }}</p>
        <p>Unacked: {{ m!.messagesUnacked }}</p>
        <p>Total: {{ m!.messagesTotal }}</p>
      </div>
    }
  </div>
}

@if ($selectedTab() === 'advanced') {
  <div>
    <h3>Advanced</h3>

    <div>
      <strong>Stats</strong>
      <pre>{{ $stats() | json }}</pre>
    </div>

    <h4>DLQ Tools</h4>
    <input [(ngModel)]="dlqQueue" placeholder="DLQ Name" />
    <button (click)="peekDlq()">Peek DLQ</button>
    <button (click)="requeueDlq()">Requeue</button>

    <pre>{{ $dlq() | json }}</pre>
  </div>
}
